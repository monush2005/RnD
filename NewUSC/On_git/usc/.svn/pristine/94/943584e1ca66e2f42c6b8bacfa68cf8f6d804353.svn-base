(function(app) {
    'use strict';
    app.component('editRoleComponent', {
        templateUrl: 'resources/app/components/roleComponents/editRoleComponent/editRoleComponent.html',
        controller: editRoleComponentController,
        controllerAs: 'vm',
        bindings: {

        }
    })

    editRoleComponentController.$inject = ['$localStorage', 'rolesRightsService', 'customDialogService', 'customToastService'];

    function editRoleComponentController($localStorage, rolesRightsService, customDialogService, customToastService) {
        var vm = this;
        vm.getAndEditRole = getAndEditRole;

        vm.$onInit = function() {
            vm.rolesPromise = rolesRightsService.getMyRoles().then((roles) => {
                vm.allRoles = roles;
            })
        }

        function getAndEditRole(role) {
            role.getRolePromise = rolesRightsService.getRoleDetails(role.roleId).then((rightsForRole) => {
                customDialogService.showComponent({
                    component: 'createRoleComponent',
                    clickOutsideToClose: false,
                    bindings: {
                        role: {roleName: role.roleName, roleId: role.roleId, rights: rightsForRole},
                        dialogMode: true
                    }
                }).then((newRoleName) => {
                    role.roleName = newRoleName;
                    customToastService.freeText('Changes to role have been successfully made!')
                })
            })
        }
    }
})(angular.module('selfcare'));
